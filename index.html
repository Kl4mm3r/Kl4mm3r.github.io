<!DOCTYPE HTML>

<?php

$errors = [];
$errorMessage = '';

$secret = 'your secret key';

if (!empty($_POST)) {
    $name = $_POST['name'];
    $email = $_POST['email'];
    $message = $_POST['message'];
    $recaptchaResponse = $_POST['g-recaptcha-response'];

    $recaptchaUrl = "https://www.google.com/recaptcha/api/siteverify?secret={$secret}&response={$recaptchaResponse}";
    $verify = json_decode(file_get_contents($recaptchaUrl));

    if (!$verify->success) {
      $errors[] = 'Recaptcha failed';
    }

    if (empty($name)) {
        $errors[] = 'Name is empty';
    }

    if (empty($email)) {
        $errors[] = 'Email is empty';
    } else if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
        $errors[] = 'Email is invalid';
    }

    if (empty($message)) {
        $errors[] = 'Message is empty';
    }


    if (!empty($errors)) {
        $allErrors = join('<br/>', $errors);
        $errorMessage = "<p style='color: red;'>{$allErrors}</p>";
    } else {
        $toEmail = 'some.nugget@gmail.com';
        $emailSubject = 'New email from your contant form';
        $headers = ['From' => $email, 'Reply-To' => $email, 'Content-type' => 'text/html; charset=iso-8859-1'];

        $bodyParagraphs = ["Name: {$name}", "Email: {$email}", "Message:", $message];
        $body = join(PHP_EOL, $bodyParagraphs);

        if (mail($toEmail, $emailSubject, $body, $headers)) {
            header('Location: thank-you.html');
        } else {
            $errorMessage = "<p style='color: red;'>Oops, something went wrong. Please try again later</p>";
        }
    }
}

?>

<html>
	<head>
		<title>KlammerLine</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="homepage is-preload">
		<div id="page-wrapper">

			<!-- Header -->
				<section id="header">
					<div class="container">

						<!-- Logo -->
							<a href="#" class="image featured"><img src="images/klammerline.png" alt="" /></a>

						<!-- Nav -->
						<!--	<nav id="nav">
								<ul>
									<li><a class="icon solid fa-home" href="index.html"><span>Introduction</span></a></li>
									<li>
										<a href="#" class="icon fa-chart-bar"><span>Dropdown</span></a>
										<ul>
											<li><a href="#">Lorem ipsum dolor</a></li>
											<li><a href="#">Magna phasellus</a></li>
											<li><a href="#">Etiam dolore nisl</a></li>
											<li>
												<a href="#">Phasellus consequat</a>
												<ul>
													<li><a href="#">Magna phasellus</a></li>
													<li><a href="#">Etiam dolore nisl</a></li>
													<li><a href="#">Phasellus consequat</a></li>
												</ul>
											</li>
											<li><a href="#">Veroeros feugiat</a></li>
										</ul>
									</li>
									<li><a class="icon solid fa-cog" href="left-sidebar.html"><span>Left Sidebar</span></a></li>
									<li><a class="icon solid fa-retweet" href="right-sidebar.html"><span>Right Sidebar</span></a></li>
									<li><a class="icon solid fa-sitemap" href="no-sidebar.html"><span>No Sidebar</span></a></li>
								</ul>
							</nav>
						-->
					</div>
				</section>

			<!-- Features -->
				<section id="features">
					<div class="container">
						<header>
							<h2>Meine Projekte</h2>
						</header>
						<div class="row aln-center">
							<div class="col-4 col-6-medium col-12-small">

								<!-- Feature -->
									<section>
										<a href="#" class="image featured"><img src="images/Rose.jfif" alt="" /></a>
										<header>
											<h3>Rosen</h3>
										</header>
										<p>Das sind <strong>selbsgehäkelte</strong> Rosen, welche sich perfekt für den
										Valentinstag eignen. </p>
									</section>

							</div>
							<div class="col-4 col-6-medium col-12-small">

								<!-- Feature -->
									<section>
										<a href="#" class="image featured"><img src="images/Sonnenblume.jfif" alt="" /></a>
										<header>
											<h3>Sonnenblume</h3>
										</header>
										<p>Perfekt für Personen die nicht unbedingt einen grünen Daumen besitzen und doch gerne Blumen
										bei sich im Haus stehen haben.</p>
									</section>

							</div>
							<div class="col-4 col-6-medium col-12-small">

								<!-- Feature -->
									<section>
										<a href="#" class="image featured"><img src="images/sw5.jfif" alt="" /></a>
										<header>
											<h3>Sorgenwürmchen</h3>
										</header>
										<p>Hin und wieder braucht jeder einen kleinen Trostspender und wenn niemand in der Nähe ist übernimm ich
										das gerne für dich.</p>
									</section>

							</div>
							<!--
							<div class="col-12">
								<ul class="actions">
									<li><a href="#" class="button icon solid fa-file">Tell Me More</a></li>
								</ul>
							</div>
							-->
							<p></p>
						</div>
						<div class="row aln-center">
							<div class="col-4 col-6-medium col-12-small">

								<!-- Feature -->
									<section>
										<a href="#" class="image featured"><img src="images/sw2.jfif" alt="" /></a>
										<header>
											<h3>Glücksbringer</h3>
										</header>
										<p>Für Silvester oder einfach falls man jemanden Viel Glück in einem neuem oder schwierigem Lebensabschnitt
										wünscht ist ein handgefertigter Glücksbringer perfekt.</p>
									</section>

							</div>
							<div class="col-4 col-6-medium col-12-small">

								<!-- Feature -->
									<section>
										<a href="#" class="image featured"><img src="images/sw4.jfif" alt="" /></a>
										<header>
											<h3>Personalisierte Sorgenwürmchen</h3>
										</header>
										<p>Für jegliche Anlässe einen maßgeschneiderten Sorgenwurm mit personalisierten Namen.</p>
									</section>

							</div>
							<div class="col-4 col-6-medium col-12-small">

								<!-- Feature -->
									<section>
										<a href="#" class="image featured"><img src="images/sw1.jfif" alt="" /></a>
										<header>
											<h3>Engel</h3>
										</header>
										<p>Sei es als Christbaum Deko oder einfach um den weinachtlichen Geist im Haus einzufangen.</p>
									</section>

							</div>
							<!--
							<div class="col-12">
								<ul class="actions">
									<li><a href="#" class="button icon solid fa-file">Tell Me More</a></li>
								</ul>
							</div>
							-->
						</div>
					</div>
				</section>

			<!-- Banner -->
				<section id="banner">
					<div class="container">
						<p>Hier kommt bald mehr. Bleib gespannt!</p>
					</div>
				</section>
			
			<!-- Footer -->
				<section id="footer">
					<div class="container">
						<header>
							<h2>Fragen oder Anliegen?<strong>Schreib mir:</strong></h2>
						</header>
						<div class="row">
							<div class="col-6 col-12-medium">
								<section>
									<form action="/form.php" method="post" id="contact-form">
										<?php echo((!empty($errorMessage)) ? $errorMessage : '') ?>
										<div class="row gtr-50">
											<div class="col-6 col-12-small">
												<input name="name" placeholder="Name" type="text" />
											</div>
											<div class="col-6 col-12-small">
												<input name="email" placeholder="Email" type="text" />
											</div>
											<div class="col-12">
												<textarea name="message" placeholder="Nachricht"></textarea>
											</div>
											<div class="col-12">
												<button type="submit" value="submit">Nachricht senden</button>
											</div>
										</div>
									</form>
								</section>
							</div>
							<div class="col-6 col-12-medium">
								<section>
									<div class="row">
										<div class="col-6 col-12-small">
											<ul class="icons">
												<li class="icon solid fa-building">
													Martina Klammer
												</li>
												<li class="icon solid fa-home">
													Höhenweg 105<br />
													Viktring, 9073<br />
													Österreich
												</li>
												<li class="icon solid fa-phone">
													+436605573313
												</li>
												<li class="icon solid fa-envelope">
													<a href="#">martina@klammerline.at</a>
												</li>
											</ul>
										</div>
										<div class="col-6 col-12-small">
											<ul class="icons">
												<li class="icon brands fa-instagram">
													<a href="#">instagram.com/klammerline</a>
												</li>
												<li class="icon brands fa-facebook-f">
													<a href="#">facebook.com/klammerline</a>
												</li>
											</ul>
										</div>
									</div>
								</section>
							</div>
						</div>
					</div>
					
				</section>

		</div>

		<!-- Scripts -->
			<script>
				  const constraints = {
					  name: {
						  presence: {allowEmpty: false}
					  },
					  email: {
						  presence: {allowEmpty: false},
						  email: true
					  },
					  message: {
						  presence: {allowEmpty: false}
					  }
				  };

				  const form = document.getElementById('contact-form');

				  form.addEventListener('submit', function (event) {
					  const formValues = {
						  name: form.elements.name.value,
						  email: form.elements.email.value,
						  message: form.elements.message.value
					  };

					  const errors = validate(formValues, constraints);

					  if (errors) {
						  event.preventDefault();
						  const errorMessage = Object
							  .values(errors)
							  .map(function (fieldValues) {
								  return fieldValues.join(', ')
							  })
							  .join("\n");

						  alert(errorMessage);
					  }
				  }, false);

				  function onRecaptchaSuccess () {
					  document.getElementById('contact-form').submit()
				  }
			</script>
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>